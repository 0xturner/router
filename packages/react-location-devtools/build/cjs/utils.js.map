{"version":3,"file":"utils.js","sources":["../../src/utils.ts"],"sourcesContent":["import React from 'react'\nimport { DefaultGenerics, RouteMatch } from '@tanstack/react-location'\n\nimport { Theme, useTheme } from './theme'\nimport useMediaQuery from './useMediaQuery'\n\nexport const isServer = typeof window === 'undefined'\n\ntype StyledComponent<T> = T extends 'button'\n  ? React.DetailedHTMLProps<\n      React.ButtonHTMLAttributes<HTMLButtonElement>,\n      HTMLButtonElement\n    >\n  : T extends 'input'\n  ? React.DetailedHTMLProps<\n      React.InputHTMLAttributes<HTMLInputElement>,\n      HTMLInputElement\n    >\n  : T extends 'select'\n  ? React.DetailedHTMLProps<\n      React.SelectHTMLAttributes<HTMLSelectElement>,\n      HTMLSelectElement\n    >\n  : T extends keyof HTMLElementTagNameMap\n  ? React.HTMLAttributes<HTMLElementTagNameMap[T]>\n  : never\n\nexport function getStatusColor(\n  match: RouteMatch<DefaultGenerics>,\n  theme: Theme,\n) {\n  return match.isLoading\n    ? theme.active\n    : match.status === 'rejected'\n    ? theme.danger\n    : match.status === 'pending'\n    ? theme.warning\n    : theme.success\n}\n\n// export function getQueryStatusLabel(query: Query) {\n//   return query.state.isFetching\n//     ? 'fetching'\n//     : !query.getObserversCount()\n//     ? 'inactive'\n//     : query.isStale()\n//     ? 'stale'\n//     : 'fresh'\n// }\n\ntype Styles =\n  | React.CSSProperties\n  | ((props: Record<string, any>, theme: Theme) => React.CSSProperties)\n\nexport function styled<T extends keyof HTMLElementTagNameMap>(\n  type: T,\n  newStyles: Styles,\n  queries: Record<string, Styles> = {},\n) {\n  return React.forwardRef<HTMLElementTagNameMap[T], StyledComponent<T>>(\n    ({ style, ...rest }, ref) => {\n      const theme = useTheme()\n\n      const mediaStyles = Object.entries(queries).reduce(\n        (current, [key, value]) => {\n          // eslint-disable-next-line react-hooks/rules-of-hooks\n          return useMediaQuery(key)\n            ? {\n                ...current,\n                ...(typeof value === 'function' ? value(rest, theme) : value),\n              }\n            : current\n        },\n        {},\n      )\n\n      return React.createElement(type, {\n        ...rest,\n        style: {\n          ...(typeof newStyles === 'function'\n            ? newStyles(rest, theme)\n            : newStyles),\n          ...style,\n          ...mediaStyles,\n        },\n        ref,\n      })\n    },\n  )\n}\n\nexport function useIsMounted() {\n  const mountedRef = React.useRef(false)\n  const isMounted = React.useCallback(() => mountedRef.current, [])\n\n  React[isServer ? 'useEffect' : 'useLayoutEffect'](() => {\n    mountedRef.current = true\n    return () => {\n      mountedRef.current = false\n    }\n  }, [])\n\n  return isMounted\n}\n\n/**\n * This hook is a safe useState version which schedules state updates in microtasks\n * to prevent updating a component state while React is rendering different components\n * or when the component is not mounted anymore.\n */\nexport function useSafeState<T>(initialState: T): [T, (value: T) => void] {\n  const isMounted = useIsMounted()\n  const [state, setState] = React.useState(initialState)\n\n  const safeSetState = React.useCallback(\n    (value: T) => {\n      scheduleMicrotask(() => {\n        if (isMounted()) {\n          setState(value)\n        }\n      })\n    },\n    [isMounted],\n  )\n\n  return [state, safeSetState]\n}\n\n/**\n * Schedules a microtask.\n * This can be useful to schedule state updates after rendering.\n */\nfunction scheduleMicrotask(callback: () => void) {\n  Promise.resolve()\n    .then(callback)\n    .catch((error) =>\n      setTimeout(() => {\n        throw error\n      }),\n    )\n}\n"],"names":["isServer","window","getStatusColor","match","theme","isLoading","active","status","danger","warning","success","styled","type","newStyles","queries","React","forwardRef","ref","style","rest","useTheme","mediaStyles","Object","entries","reduce","current","key","value","useMediaQuery","createElement","useIsMounted","mountedRef","useRef","isMounted","useCallback","useSafeState","initialState","useState","state","setState","safeSetState","scheduleMicrotask","callback","Promise","resolve","then","error","setTimeout"],"mappings":"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"}